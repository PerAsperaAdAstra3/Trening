<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<script src="../../scripts/jquery-3.2.1.min.js"></script>
<script src="../../scripts/bootstrap.min.js"></script>
<script src="../../scripts/functions.js"></script>
<script src="../../scripts/filterTable.js"></script>
<script src="../../scripts/ajaxFunctions.js"></script>
<meta charset="UTF-8"/>
<title>Treninzi</title>
<link rel="stylesheet" type="text/css" th:href="@{/css/bootstrap.min.css}"/>
<link rel="stylesheet" type="text/css" th:href="@{/css/style.css}"/>
<script>
	$(document).on("click", "#tr-entity-list", function(event) {
		highlightRow(this)
	});
	
	$(document).on("click", "#tr-entity-list-modal", function(event) {
		highlightRow1(this)
		$('#myModal').modal('hide')
		$("#hiddenButtonToCopyTraining").click()
	});
	
	$(document).on("click", "#search", function(event) {
		$("#hidden_input").css('display','table-row');
	});
	  /*<![CDATA[*/	
		function sortTable() {
			  var table, rows, switching, i, x, y, shouldSwitch;
			  table = document.getElementById("training");
			  switching = true;
			  /* Make a loop that will continue until
			  no switching has been done: */
			  while (switching) {
			    // Start by saying: no switching is done:
			    switching = false;
			    rows = table.rows;
			    /* Loop through all table rows (except the
			    first, which contains table headers): */
			    for (i = 1; i < (rows.length - 1); i++) {
			      // Start by saying there should be no switching:
			      shouldSwitch = false;
			      /* Get the two elements you want to compare,
			      one from current row and one from the next: */
			      x = rows[i].getElementsByTagName("TD")[0];
			      y = rows[i + 1].getElementsByTagName("TD")[0];
			      // Check if the two rows should switch place:
			      if (x.innerHTML.toLowerCase() < y.innerHTML.toLowerCase()) {
			        // If so, mark as a switch and break the loop:
			        shouldSwitch = true;
			        break;
			      }
			    }
			    if (shouldSwitch) {
			      /* If a switch has been marked, make the switch
			      and mark that a switch has been done: */
			      rows[i].parentNode.insertBefore(rows[i + 1], rows[i]);
			      switching = true;
			    }
			  }
			  switching = true;
			  while (switching) {
				    // Start by saying: no switching is done:
				    switching = false;
				    rows = table.rows;
				    /* Loop through all table rows (except the
				    first, which contains table headers): */
				    for (i = 1; i < (rows.length - 1); i++) {
				      // Start by saying there should be no switching:
				      shouldSwitch = false;
				      /* Get the two elements you want to compare,
				      one from current row and one from the next: */
				      x = rows[i].getElementsByTagName("TD")[1];
				      y = rows[i + 1].getElementsByTagName("TD")[1];
				      // Check if the two rows should switch place:
				      if (x.innerHTML.toLowerCase() < y.innerHTML.toLowerCase()) {
				        // If so, mark as a switch and break the loop:
				        shouldSwitch = true;
				        break;
				      }
				    }
				    if (shouldSwitch) {
				      /* If a switch has been marked, make the switch
				      and mark that a switch has been done: */
				      rows[i].parentNode.insertBefore(rows[i + 1], rows[i]);
				      switching = true;
				    }
				  }
			}
		/*]]>*/
	$(document).on("click", "#copyTrainingButton", function(event) {
		treID = item.find(".idOfCopiedTraining").html()
	});

	
	$(window).scroll(function() {
		  sessionStorage.scrollTop = $(this).scrollTop();
		});

	$(document).ready(function() {
		  if (sessionStorage.scrollTop != "undefined") {
		    $(window).scrollTop(sessionStorage.scrollTop);
		  }
		  var errorVariable = $("#errorMessage").val();
		  if(errorVariable == 0){
			  $("#pdfErrorMessage").hide();
		  } else {
			  $("#pdfErrorMessage").show();
		  }
		  sortTable()
		  
	});
	
	$(document).on("click", "#PDFButton", function() {
		var trainingId = $(this).parent().parent().find(".trainingId").html();
		PDFprintAjaxListPage(trainingId);
	});
		
	function sync(item){
		name = item.find(".clientName").html()
	    familyName = item.find(".clientFamilyName").html()
	    
		idTrainingCopied = item.find(".trainingId").html()
		
	    
		idClientToCopy = item.find(".clientSelectId").html()
		
		posleSinca = item.find("#idOfCopiedTraining").html()
		
		$("#idOfCopiedTraining").val(idTrainingCopied);
		$("#idOfClientToCopyTo").val(idClientToCopy);
		
		
	    $("#name").val(name);
	    $("#familyName").val(familyName);
	    $("#id").val(posleSinca);
	}
	
	function highlightRow1(row){
	if(!$(row).hasClass("header")){
		$(row).parent().find(".highlighted").removeClass("highlighted");
    	$(row).addClass("highlighted");
    	sync1($(row));
    }
}
	
	function sync1(item){
		name = item.find(".clientName").html()
	    familyName = item.find(".clientFamilyName").html()	    
		idClientToCopy = item.find(".clientSelectId").html()
		
		$("#idOfClientToCopyTo").val(idClientToCopy);
	    $("#name").val(name);
	    $("#familyName").val(familyName);
	}
	
</script>
</head>
<body class="gradient">
	<div class="alert div1" role="alert">
		<a href="/" class="home">Početna</a>
		<h1 align="center">Treninzi u sistemu</h1>
	</div>
	<a style="padding-left:3em" th:href="@{/addTrainingToClient}"><button class="btn btn-success">Kreiraj trening</button></a>
	<br/>
	<br/>
	<br/>
	<!-- Modal -->
<form th:action="@{/copyTraining}" method="GET">
	<input id="idOfCopiedTraining" type="hidden" th:value="${idOfCopiedTraining}" name="idOfCopiedTraining"/>
	<input id="idOfClientToCopyTo" type="hidden" th:value="${idOfClientToCopyTo}" name="idOfClientToCopyTo"/>
	<button id="hiddenButtonToCopyTraining" type="submit" style="display:none;">Kopiraj traning</button>
</form>
<div id="myModal" class="modal fade" role="dialog">
  <div class="modal-dialog modal-lg" >

    <!-- Modal content-->
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal">&times;</button>
        <h4 class="modal-title">Klijenti</h4>
      </div>
      <div class="modal-body">
<input type="text" id="inputFilterByName" onkeyup="filterModalClient(0)" placeholder="Filtriranje po nazivu.."/>
<input type="text" id="inputFilterByFamilyName" onkeyup="filterModalClient(1)" placeholder="Filtriranje po prezimenu.."/>
<input type="text" id="inputFilterByEmail" onkeyup="filterModalClient(2)" placeholder="Filtriranje po email.."/>
<input type="text" id="inputFilterByPhone" onkeyup="filterModalClient(3)" placeholder="Filtriranje po broju telefona.."/>
<div class="container-responsive">
	<table style="width:100%" id = "myTableExercises" class = "table table-responsive">
		<thead>
			<tr>
				<th scope="col">Ime:</th>
				<th scope="col">Prezime:</th>
				<th scope="col">Email:</th>
				<th scope="col">Broj telefona:</th>
				<th scope="col"></th>
			</tr>
		</thead>
		<tbody>
			<tr class="modal-table-coloring" id="tr-entity-list-modal" th:each = "client : ${clients}">
				<td class="clientSelectName" th:utext="${client.name}"></td>
				<td class="clientSelectFamilyName" th:utext="${client.familyName}"></td>
				<td class="clientSelectEmail" th:utext="${client.email}"></td>
				<td class="clientSelectPhoneNumber" th:utext="${client.phoneNumber}"></td>
				<td class="clientSelectId" th:utext="${client.id}" style="display:none;"></td>
			</tr>
		</tbody>
	</table>
</div>

      </div>
     
    </div>
  </div>
</div>
	
<form method="POST">
<div style="padding-left:3em">
	<p><b> Filtriranje: </b></p>
		<input type="text" id="inputFilterDate" onkeyup="filterTable(0,4)" placeholder="Filtriranje po datumu.."/>
		<input type="text" id="inputFilterNumberOfTrainings" onkeyup="filterTable(1,4)" placeholder="Filtriranje po broju treninga.."/>
		<input type="text" id="inputFilterClientName" onkeyup="filterTable(2,4)" placeholder="Filtriranje po imenu.."/>
		<input type="text" id="inputFilterFamilyName" onkeyup="filterTable(3,4)" placeholder="Filtriranje po prezimenu.."/>
		<input id="errorMessage" type="hidden" th:value="${errorMessage}" name="errorMessage"/>
        <label id="pdfErrorMessage" class="errorText"><font color="red"><b>PDF fajl koji ste pokušali odštampati je otvoren, štampanje nije uspelo!</b></font></label>
	<br/>
	<br/>
	<br/>
</div>
<table id="training" class="table table-hover">
	<thead>
		<tr>
			<th scope="col">Datum</th>
			<th scope="col">Redni broj</th>
			<th scope="col">Ime klijenta</th>
			<th scope="col">Prezime klijenta</th>
			<th scope="col"></th>
		</tr>
	</thead>	
	<tbody>
		<tr	id="tr-entity-list" th:each = "training : ${trainings}">
			<td scope="row" class="clientId" th:utext="${training.date}"></td>
			<td class="trainingNumberOfTra" th:utext="${training.numberOfTrainings}"></td>
			<td class="trainingClientName" th:utext="${training.client}"></td>
			<td class="trainingClientName" th:utext="${training.clientFamilyName}"></td>
			<td class="trainingId" th:utext="${training.id}" style="display:none;"></td>
			<td><a th:href="@{/getTraining/{id}/(id=${training.id})}"><button type="button" class="btn btn-success">Izmeni</button></a></td>
			<td><a th:href="@{/deleteTraining/{id}/(id=${training.id})}"><button type="button" class="btn btn-danger">Briši</button></a></td>
			<td><button id="PDFButton" type="button" class="btn btn-danger">PDF</button></td>
			<td><button  id="modal_button" type="button" class="btn btn-success" data-toggle="modal" data-target="#myModal">Kopiraj</button></td>
		</tr>
	</tbody>
</table>
</form>
</body>
</html>